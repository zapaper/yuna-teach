generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  name      String
  role      Role     @default(STUDENT)
  level     Int?     // Primary 1-6, only for students
  createdAt DateTime @default(now())

  tests              SpellingTest[]
  examPapers         ExamPaper[]    @relation("UploadedPapers")
  assignedExamPapers ExamPaper[]    @relation("AssignedPapers")

  @@map("users")
}

model SpellingTest {
  id        String   @id @default(cuid())
  title     String
  subtitle  String?
  language  Language @default(CHINESE)
  imageUrl  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    String

  user  User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  words Word[]

  @@map("spelling_tests")
}

model Word {
  id             String  @id @default(cuid())
  text           String
  orderIndex     Int
  enabled        Boolean @default(true)
  spellingTestId String

  spellingTest SpellingTest @relation(fields: [spellingTestId], references: [id], onDelete: Cascade)

  @@map("words")
}

enum Role {
  STUDENT
  PARENT
}

model ExamPaper {
  id        String   @id @default(cuid())
  title     String
  school    String?
  level     String?
  subject   String?
  year      String?
  semester  String?
  pageCount Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId       String
  assignedToId String?

  user       User           @relation("UploadedPapers", fields: [userId], references: [id], onDelete: Cascade)
  assignedTo User?          @relation("AssignedPapers", fields: [assignedToId], references: [id], onDelete: SetNull)
  questions  ExamQuestion[]

  @@map("exam_papers")
}

model ExamQuestion {
  id              String  @id @default(cuid())
  questionNum     String
  imageData       String
  answer          String?
  answerImageData String?
  pageIndex       Int
  orderIndex      Int
  yStartPct       Float?
  yEndPct         Float?
  examPaperId     String

  examPaper ExamPaper @relation(fields: [examPaperId], references: [id], onDelete: Cascade)

  @@map("exam_questions")
}

enum Language {
  CHINESE
  ENGLISH
}
